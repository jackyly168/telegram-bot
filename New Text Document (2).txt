import csv
from telegram.ext import Updater, CommandHandler, MessageHandler, Filters

responses = {}

def load_responses():
    global responses
    responses.clear()
    with open("responses.csv", "r", encoding="utf-8") as f:
        reader = csv.DictReader(f)
        for row in reader:
            keyword = row["keyword"].strip().lower()
            response = row["response"].strip()
            responses[keyword] = response

def start(update, context):
    update.message.reply_text("✅ Bot is running! Type something...")

def handle_message(update, context):
    text = update.message.text.lower().strip()
    for keyword, response in responses.items():
        if keyword in text:
            update.message.reply_text(response)
            return
    update.message.reply_text("❓ Sorry, I don’t understand.")

def main():
    TOKEN = "8251217158:AAGCcdrKtqkdf7i_7YbKuljXsTRdTzZWjWY"
    updater = Updater(TOKEN, use_context=True)
    dp = updater.dispatcher

    dp.add_handler(CommandHandler("start", start))
    dp.add_handler(MessageHandler(Filters.text & ~Filters.command, handle_message))

    load_responses()

    updater.start_polling()
    updater.idle()

if __name__ == "__main__":
    main()
